function submitcomment(e){var a=!1;$("#nickname").parent().parent().removeClass("has-error"),$("#email").parent().parent().removeClass("has-error"),$("#newcomment").parent().parent().removeClass("has-error"),$(".error-message").remove(),$("#nickname").val($("#nickname").val().trim()),$("#email").val($("#email").val().trim()),isValidNickname($("#nickname").val())||($("#nickname").parent().parent().addClass("has-error"),a=!0),isValidMail($("#email").val())||($("#email").parent().parent().addClass("has-error"),a=!0),""==$("#newcomment").val().trim()&&($("#newcomment").parent().parent().addClass("has-error"),a=!0),data=gen_comment_obj(e),0==a&&$.ajax({url:"/comment",type:"POST",data:data,contentType:"application/json",success:function(e){if(e=JSON.stringify(e),1==e.success)alert(e.message);else{var a="<span id='tmp'>评论成功</span>";$("#message").html(""),$("#message").html(a),$("#tmp").fadeOut(3e3,document.location.reload())}},error:function(){alert("server error")}})}function gen_comment_obj(e){var a={};return a.nickname=$("#nickname").val(),a.email=$("#email").val(),a.content=$("#newcomment").val(),a.website=$("#website").val(),a.parent_comment_id=null,e=$(e).parent().parent().parent().parent(),e.hasClass("bigwidget")||(a.parent_comment_id=e.children(".c-content").attr("_id")),a.post_id=$("#post_id").val(),a=JSON.stringify(a)}$(document).ready(function(){makecommenthtml=$("#comment-widget").html(),$(".c-quote").click(function(){if($(".c-form").remove(),"#c-new"!=$(this).attr("href")){$("#c-new").hide(),$(this).parent().parent().append(makecommenthtml);var e=$(this).parent().children(".c-nickname").text();return $("#newcomment").attr("placeholder","回复 "+e+"\n不支持特殊标签"),!1}$("#c-new").html(""),$("#c-new").html(makecommenthtml),$("#c-new").show()})});